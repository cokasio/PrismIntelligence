# Tasks API Documentation

## Overview
The Tasks API provides endpoints for managing tasks generated by the AI analysis system. All endpoints require authentication and return JSON responses.

## Base URL
```
/api/tasks
```

## Endpoints

### 1. List Tasks
Get a paginated list of tasks with optional filters.

**Endpoint:** `GET /api/tasks`

**Query Parameters:**
| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| page | number | 1 | Page number for pagination |
| limit | number | 20 | Number of tasks per page |
| status | string | all | Filter by status: pending, in_progress, completed, overdue, all |
| assignedRole | string | all | Filter by role: CFO, PropertyManager, Maintenance, Accounting, Leasing, all |
| propertyId | uuid | - | Filter by property ID |
| dateFrom | string | - | Filter tasks due after this date (ISO format) |
| dateTo | string | - | Filter tasks due before this date (ISO format) |
| sortBy | string | dueDate | Sort by: dueDate, priority, potentialValue, createdAt |
| sortOrder | string | asc | Sort order: asc, desc |

**Response:**
```json
{
  "tasks": [
    {
      "id": "uuid",
      "title": "Review HVAC Maintenance Contract",
      "description": "Detailed description...",
      "priority": 2,
      "assigned_role": "PropertyManager",
      "due_date": "2024-01-20T00:00:00Z",
      "estimated_hours": 4,
      "potential_value": 12000,
      "status": "pending",
      "properties": {
        "name": "Sunset Gardens",
        "address": "123 Main St"
      }
    }
  ],
  "total": 45,
  "page": 1,
  "totalPages": 3,
  "filters": {
    "status": "pending",
    "assignedRole": "all",
    "propertyId": null,
    "dateRange": null
  },
  "sort": {
    "by": "dueDate",
    "order": "asc"
  }
}
```

### 2. Get Single Task
Get detailed information about a specific task.

**Endpoint:** `GET /api/tasks/{id}`

**Parameters:**
- `id` (path) - Task UUID

**Response:**
```json
{
  "id": "uuid",
  "title": "Review HVAC Maintenance Contract",
  "description": "Detailed step-by-step instructions...",
  "priority": 2,
  "assigned_role": "PropertyManager",
  "due_date": "2024-01-20T00:00:00Z",
  "estimated_hours": 4,
  "actual_hours": null,
  "potential_value": 12000,
  "source_insight": "HVAC costs increased 35% YoY",
  "status": "pending",
  "created_at": "2024-01-15T10:00:00Z",
  "updated_at": "2024-01-15T10:00:00Z",
  "properties": {
    "id": "uuid",
    "name": "Sunset Gardens",
    "address": "123 Main St"
  },
  "reports": {
    "id": "uuid",
    "title": "January 2024 P&L",
    "document_name": "jan-2024-pl.pdf"
  },
  "task_outcomes": [],
  "is_overdue": false,
  "days_until_due": 5
}
```

### 3. Update Task
Update task details (status, notes, assignment, etc).

**Endpoint:** `PATCH /api/tasks/{id}`

**Parameters:**
- `id` (path) - Task UUID

**Request Body:**
```json
{
  "status": "in_progress",
  "notes": "Started vendor negotiations",
  "actual_hours": 1.5,
  "assigned_to": "user-uuid",
  "due_date": "2024-01-25T00:00:00Z"
}
```

**Response:** Updated task object

### 4. Complete Task
Mark a task as complete with outcome details.

**Endpoint:** `POST /api/tasks/{id}/complete`

**Parameters:**
- `id` (path) - Task UUID

**Request Body:**
```json
{
  "completion_notes": "Successfully negotiated 20% reduction in HVAC contract",
  "actual_hours": 3.5,
  "actual_value": 15000,
  "success_rating": 5
}
```

**Response:**
```json
{
  "id": "uuid",
  "status": "completed",
  "completed_at": "2024-01-18T14:30:00Z",
  "outcome": {
    "id": "uuid",
    "outcome_description": "Successfully negotiated 20% reduction in HVAC contract",
    "actual_value_realized": 15000,
    "time_saved_hours": 0.5,
    "success_rating": 5
  },
  "message": "Task completed successfully"
}
```

## Error Responses

All endpoints return appropriate HTTP status codes:

- `200` - Success
- `400` - Bad request (invalid parameters)
- `404` - Resource not found
- `500` - Internal server error

Error response format:
```json
{
  "error": "Error message",
  "details": [] // Optional, validation errors
}
```

## Testing

Use the provided test script:
```bash
cd apps/dashboard-nextjs
node test-tasks-api.js
```

Make sure to:
1. Have the Next.js dev server running (`npm run dev`)
2. Have valid task data in your database
3. Update the test script with a real task ID for single task tests