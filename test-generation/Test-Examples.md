# PrismIntelligence Test Examples Using AI Tools

## 1. Testing Email Ingestion with Aider

```bash
# Start aider with the email service
aider src/services/email.ts src/api/routes.ts tests/integration/email-ingestion.test.ts

# In Aider prompt:
> Create a comprehensive test suite for the SendGrid webhook endpoint that:
> - Tests valid property report submissions
> - Handles multiple file formats (PDF, Excel, CSV)
> - Tests error cases (no attachment, invalid format, oversized files)
> - Mocks SendGrid webhook signatures
> - Verifies queue job creation
> Include realistic test data based on property management reports
```

## 2. Testing Multi-Agent AI Pipeline

```bash
# Use Claude Code for complex AI pipeline tests
claude-code generate test --context "
The system uses:
1. Gemini for initial classification
2. Claude for 4-pass analysis (extraction, verification, insights, actions)
3. Multi-agent orchestration

Create integration tests that verify:
- Correct agent selection based on document type
- Pass-through of context between agents
- Error handling when one agent fails
- Performance benchmarks for each pass
"
```

## 3. Property Report Parser Tests

```javascript
// Example test generated by Gemini CLI
// tests/parsers/propertyReportParser.test.ts

import { PropertyReportParser } from '../../src/parsers/propertyReportParser';
import { loadTestFixture } from '../helpers/fixtures';

describe('PropertyReportParser', () => {
  let parser: PropertyReportParser;
  
  beforeEach(() => {
    parser = new PropertyReportParser();
  });

  describe('PDF Parsing', () => {
    it('should extract financial data from standard P&L report', async () => {
      const pdfBuffer = await loadTestFixture('standard-pnl-report.pdf');
      const result = await parser.parsePDF(pdfBuffer);
      
      expect(result).toMatchObject({
        reportType: 'P&L',
        period: expect.any(String),
        properties: expect.arrayContaining([
          expect.objectContaining({
            name: expect.any(String),
            revenue: expect.any(Number),
            expenses: expect.any(Number),
            noi: expect.any(Number)
          })
        ])
      });
    });

    it('should handle multi-property consolidated reports', async () => {
      const pdfBuffer = await loadTestFixture('multi-property-consolidated.pdf');
      const result = await parser.parsePDF(pdfBuffer);
      
      expect(result.properties).toHaveLength(5);
      expect(result.totals).toBeDefined();
    });
  });
});
```

## 4. AI Analysis Quality Tests

```javascript
// tests/services/ai-analysis-quality.test.ts
// Generated using Aider with domain knowledge

describe('AI Analysis Quality Assurance', () => {
  const testCases = [
    {
      name: 'Variance Analysis',
      fixture: 'report-with-20-percent-variance.xlsx',
      expectedInsights: [
        'Revenue variance of -20% requires immediate attention',
        'Vacancy rate increased from 5% to 25%',
        'Consider rent concessions or marketing campaign'
      ]
    },
    {
      name: 'Maintenance Spike Detection',
      fixture: 'maintenance-cost-spike.pdf',
      expectedInsights: [
        'Maintenance costs increased 150% month-over-month',
        'HVAC system replacement at Building A',
        'Budget for similar replacements at sister properties'
      ]
    }
  ];

  testCases.forEach(({ name, fixture, expectedInsights }) => {
    it(`should correctly analyze ${name}`, async () => {
      const report = await loadTestFixture(fixture);
      const analysis = await aiService.analyzeReport(report);
      
      expectedInsights.forEach(expectedInsight => {
        const found = analysis.insights.some(insight => 
          insight.text.toLowerCase().includes(expectedInsight.toLowerCase())
        );
        expect(found).toBe(true);
      });
    });
  });
});
```

## 5. Test Data Generation Script

```javascript
// tests/generators/create-test-reports.js
// Use with: node tests/generators/create-test-reports.js

const { generatePropertyReport } = require('./report-generator');

const scenarios = [
  { 
    type: 'healthy-property',
    occupancy: 95,
    expenseRatio: 0.45,
    rentGrowth: 3
  },
  {
    type: 'struggling-property',
    occupancy: 75,
    expenseRatio: 0.65,
    rentGrowth: -5
  },
  {
    type: 'new-acquisition',
    occupancy: 60,
    expenseRatio: 0.55,
    rentGrowth: 0,
    notes: 'Recently acquired, in lease-up phase'
  }
];

scenarios.forEach(scenario => {
  const report = generatePropertyReport(scenario);
  saveTestFixture(`${scenario.type}.json`, report);
});
```

## 6. Performance Testing with AI

```bash
# Use Aider to create performance tests
aider tests/performance/ai-processing.perf.ts --message "
Create performance tests that:
1. Measure time for each AI pass
2. Test with reports of varying sizes (1-100 pages)
3. Concurrent processing of multiple reports
4. Memory usage during processing
5. Create performance regression alerts
Target: <10s for standard 10-page report
"
```

## 7. End-to-End Test Scenario

```javascript
// tests/e2e/complete-flow.test.ts
// Generated by Claude Code with business context

describe('Complete Property Report Processing Flow', () => {
  it('should process a property report from email to delivery', async () => {
    // 1. Simulate email arrival
    const webhookPayload = createSendGridPayload({
      from: 'property.manager@example.com',
      attachments: ['monthly-report.pdf']
    });
    
    const response = await request(app)
      .post('/api/webhooks/sendgrid/inbound')
      .send(webhookPayload);
      
    expect(response.status).toBe(200);
    const { reportId } = response.body;
    
    // 2. Wait for processing
    await waitForJobCompletion(reportId, { timeout: 30000 });
    
    // 3. Verify database entries
    const report = await db.getReport(reportId);
    expect(report.status).toBe('completed');
    expect(report.insights).toHaveLength(greaterThan(0));
    expect(report.actions).toHaveLength(greaterThan(0));
    
    // 4. Verify email was sent
    const emailSent = await mockEmailService.getLastSentEmail();
    expect(emailSent.to).toBe('property.manager@example.com');
    expect(emailSent.subject).toContain('Property Intelligence Report');
    expect(emailSent.html).toContain(report.insights[0].text);
  });
});
```

## Quick Commands for Each Tool

### Aider
```bash
# Generate missing tests
aider --test-coverage

# Fix failing tests
aider npm test --message "Fix all failing tests"

# Add edge cases
aider tests/ --message "Add edge case tests for multi-tenant scenarios"
```

### Claude Code
```bash
# Generate test strategy
claude-code analyze --test-strategy

# Create integration tests
claude-code generate integration-tests src/services/

# Review test quality
claude-code review tests/ --coverage-report coverage/lcov.info
```

### Gemini CLI
```bash
# Quick unit tests
gemini generate tests src/**/*.ts --jest

# Test data
gemini generate fixtures --count 50 --schema property-report

# Mocks
gemini generate mocks src/services/external/
```

## Test Execution Commands

```bash
# Run all tests
npm test

# Run with coverage
npm test -- --coverage

# Run specific test file
npm test -- tests/services/ai.test.ts

# Run in watch mode
npm test -- --watch

# Run performance tests
npm test -- --testNamePattern="Performance"

# Generate coverage report
npm test -- --coverage --coverageReporters=html
```

Remember: The best tests combine AI generation with human domain expertise!
